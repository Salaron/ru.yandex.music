id: ru.yandex.music
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'

command: run.sh

tags:
  - proprietary

finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  - --talk-name=org.gnome.SettingsDaemon.MediaKeys
  - --talk-name=org.gnome.SessionManager
  - --talk-name=com.canonical.AppMenu.Registrar
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.Notifications
  - --own-name=org.mpris.MediaPlayer2.chromium.*
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons

modules:
  - name: repack-deb
    buildsystem: simple
    build-commands:
      - ar x Yandex_Music.deb
      - tar xf data.tar.xz
      - |
        for icon in $(find ./usr/share/icons -type f -name "*.png"); do
          mv "$icon" $(echo $icon | sed -e "s|yandexmusic.png|ru.yandex.music.png|g")
        done
      - cp -r ./usr/share/icons /app/share/icons
      - cp -r "./opt/$(ls -AU ./opt | head -1)" /app/yandexmusic
      - rm /app/yandexmusic/resources/package-type
    sources:
      - type: file
        dest-filename: Yandex_Music.deb
        url: https://music-desktop-application.s3.yandex.net/stable/Yandex_Music_amd64_5.82.0.deb
        sha512: dd6ccd0cfdd2d937d5b0134bf5a1b5954cd0f43adc5507c49e53f234d687282d1e6f0b8c76c7bd72d67998a232c447e752054dd4de57ceb17d8caa7868dfca3a
        x-checker-data:
          type: electron-updater
          url: https://music-desktop-application.s3.yandex.net/stable/latest-linux.yml

  - name: desktop
    buildsystem: simple
    build-commands:
      - install -Dm755 -t /app/bin/ run.sh
      - install -Dm644 ru.yandex.music.appdata.xml /app/share/appdata/ru.yandex.music.appdata.xml
      - install -Dm644 ru.yandex.music.desktop /app/share/applications/ru.yandex.music.desktop
    sources:
      - type: file
        path: run.sh
      - type: file
        path: ru.yandex.music.appdata.xml
      - type: file
        path: ru.yandex.music.desktop
